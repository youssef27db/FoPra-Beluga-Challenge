\chapter{Beluga Competition Toolkit}
\hypertarget{md_toolkit_2_r_e_a_d_m_e}{}\label{md_toolkit_2_r_e_a_d_m_e}\index{Beluga Competition Toolkit@{Beluga Competition Toolkit}}
\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md40}%
\Hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md40}%


The competition toolkit is a set of tools which help generate and simulate problems in different formalisms (PDDL, RL, pure json, etc.). The scripts also serve as examples on how to use the competition API for your own scripts. The following list provides a high level view of the provided scripts, which are detailed in the subsequent sections of the Readme file\+:


\begin{DoxyItemize}
\item Problem generation\+: the {\ttfamily \doxylink{generate__instance_8py}{generate\+\_\+instance.\+py}} script allows a user to generate a JSON file representing a specific Beluga problem instance based on configuration variables passed to the script as arguments ;
\item PDDL encoding\+: the JSON files generated with the previous script can be then passed to the {\ttfamily \doxylink{json2_p_d_d_l_8py}{json2\+PDDL.\+py}} (resp. {\ttfamily \doxylink{encode__instances_8py}{encode\+\_\+instances.\+py}}) script to encode one (resp. multiple) PDDL instances, in either classical or numeric PDDL flavors ;
\item Scikit-\/decide domains\+: once PDDL files have been generated with the previous script, they can be passed to scikit-\/decide domains, where some of them include noise action effects for probabilistic reasoning (see details in the linked section) ; those domains can be used to call grounded search solvers (e.\+g. A\texorpdfstring{$\ast$}{*} in deterministic settings, LAO\texorpdfstring{$\ast$}{*} or LRTDP in probabilistic settings) or simulation-\/based solvers (e.\+g. MCTS, RL), as exemplified in the {\ttfamily \doxylink{generate__simulate__test_8py}{generate\+\_\+simulate\+\_\+test.\+py}} script ;
\item Gymnasium environments\+: the previous scikit-\/decide domains can also be automatically casted to Gymnasium environments by specializing the {\ttfamily Beluga\+Gym\+Compatible\+Domain} class whose aim is to define tensor-\/based observation and action spaces for use with deep reinforcement learning algorithms; while we provide a simple observation and space encodings in an example specialized class in the {\ttfamily \doxylink{generate__solve__rllib__test_8py}{generate\+\_\+solve\+\_\+rllib\+\_\+test.\+py}} script, we strongly advise our RL friends to implement their own specialized class for better learning and generalization capabilities ;
\item Evaluator\+: we finally provide the {\ttfamily \doxylink{evaluate__instance_8py}{evaluate\+\_\+instance.\+py}} script where users can evaluate their solutions by using the same protocol as the one employed by the official competition evaluation and a similar API (though not implemented via a web service, which will instead be required for the final submission)
\end{DoxyItemize}

In this file you will also find information about the uncertainty model used in the probabilistic challenge and on the distribution that was used to obtain all official benchmarks for scalability challenges in the competition.\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md41}{}\doxysection{\texorpdfstring{Problem Generator}{Problem Generator}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md41}
The problem generator generates a random Beluga instance as a JSON file.

With the script


\begin{DoxyCode}{0}
\DoxyCodeLine{generate\_instance.py\ [-\/h]\ [-\/s\ SEED]\ [-\/or\ OCCUPANCY\_RATE\_RACKS]\ [-\/t\ JIG\_T\_DIST]\ [-\/f\ NUM\_FLIGHTS]\ [-\/us\ \{rack\_space\_general,outgoing\_flight\_not\_sat,schedule\_clashes\}]\ [-\/v]\ [-\/o\ OUT]\ [-\/on\ OUT\_NAME]\ [-\/pp]\ [-\/pm\ \{arrivals,ppddl\}]\ [-\/pw\ PROBABILISTIC\_WINDOW]}

\end{DoxyCode}


you can generate one instance based on a default configuration which allows to specify a number of parameters.

For a list of possible parameters and descriptions of them call


\begin{DoxyCode}{0}
\DoxyCodeLine{generate\_instance.py\ -\/h}

\end{DoxyCode}


results it the following description\+:


\begin{DoxyItemize}
\item {\ttfamily -\/h}, {\ttfamily -\/-\/help} \+: show this help message and exit
\item {\ttfamily -\/s} SEED, {\ttfamily -\/-\/seed} SEED\+: seed for the random generator
\item {\ttfamily -\/or} OCCUPANCY\+\_\+\+RATE\+\_\+\+RACKS, {\ttfamily -\/-\/occupancy-\/rate-\/racks} OCCUPANCY\+\_\+\+RATE\+\_\+\+RACKS fraction of rack space that is initially occupied
\item {\ttfamily -\/t} JIG\+\_\+\+T\+\_\+\+DIST, {\ttfamily -\/-\/jig-\/type-\/distribution} JIG\+\_\+\+T\+\_\+\+DIST distribution of jigs types\+: (0) uniform, (1) small jigs preferred, (2) large jigs preferred (default\+: 1)
\item {\ttfamily -\/f} NUM\+\_\+\+FLIGHTS, {\ttfamily -\/-\/num-\/flights} NUM\+\_\+\+FLIGHTS number of incoming and outgoing Beluga flights
\item {\ttfamily -\/us} \mbox{[}rack\+\_\+space\+\_\+general,outgoing\+\_\+flight\+\_\+not\+\_\+sat,schedule\+\_\+clashes ...\mbox{]}, {\ttfamily -\/-\/unsolvable} \mbox{[}rack\+\_\+space\+\_\+general,outgoing\+\_\+flight\+\_\+not\+\_\+sat,schedule\+\_\+clashes ...\mbox{]} scenario based on which the generator tries to generate an unsolvable instance
\item {\ttfamily -\/v}, {\ttfamily -\/-\/verbose} print debug output
\item {\ttfamily -\/o} OUT, {\ttfamily -\/-\/out} OUT output folder for the problem, if no folder is given, the problem is printed onto stdout
\item {\ttfamily -\/on} OUT\+\_\+\+NAME, {\ttfamily -\/-\/out-\/name} OUT\+\_\+\+NAME name for the problem, if no name is defined, a name based on the number of jigs, jig types, racks, the exact occupancy rate, the number of flights, the seed and potentially the unsolvability scenarios is generated
\item {\ttfamily -\/pp}, {\ttfamily -\/-\/probabilistic} Enables the probabilistic model, triggering the generation of probabilistic instances (default\+: False)
\item {\ttfamily -\/pm \{arrivals,ppddl\}}, {\ttfamily -\/-\/probabilistic-\/model \{arrivals,ppddl\}} Controls the type of probabilistic model, if the {\ttfamily -\/pp} option is enabled. If the {\ttfamily arrivals} options is used (the default), then the instance will contain only arrival times and will be suitable for a more realistic uncertainty semantic where flights are subject to stochastic delay; if the {\ttfamily ppddl} option is used, the instance will include information on uncertainty, specified in terms of probabilities of transition between abstract states. Every abstract state is identified by the sequence of a configurable number of the last flights (default\+: arrivals)
\item {\ttfamily -\/pw PROBABILISTIC\+\_\+\+WINDOW}, {\ttfamily -\/-\/probabilistic-\/window PROBABILISTIC\+\_\+\+WINDOW} Length of the sequence of flights used as the abstract state in the \textquotesingle{}ppddl\textquotesingle{} probabilistic model. This parameter is ignored unless \textquotesingle{}ppddl\textquotesingle{} probabilistic mode is enabled (default\+: 1)
\end{DoxyItemize}

The file {\ttfamily configuration/default\+\_\+configuration.\+py} defines the values of the remaining parameters of the generator. They are described in more detail below. In the competition these parameters are fixed, and we only consider instances with varying occupancy rate, jig type distribution and number of flights.

When no unsolvability scenario is specified, then the generator tries to generate a solvable instance, however the generator does {\bfseries{not ensure solvability}}. The individual unsolvability scenarios are described below.

To generate a whole range of instances the script


\begin{DoxyCode}{0}
\DoxyCodeLine{generate\_instances.py\ [-\/h]\ -\/c\ CONFIG\_FILE\ [-\/y]\ -\/o\ OUTPUT\_FOLDER}

\end{DoxyCode}


can be used. The {\ttfamily CONFIG\+\_\+\+FILE} specifies the occupancy rate, jig type distribution and number of flights in the format\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{saturation,jig\_type\_dist,n\_flights}
\DoxyCodeLine{80.0,0.0,49.0}
\DoxyCodeLine{20.0,0.0,142.0}
\DoxyCodeLine{...}

\end{DoxyCode}
 where the {\ttfamily saturation}, {\ttfamily jig\+\_\+type\+\_\+dist} and {\ttfamily n\+\_\+flights} refer to the parameters {\ttfamily -\/-\/occupancy-\/rate-\/racks}, {\ttfamily -\/-\/jig-\/type-\/distribution} and {\ttfamily -\/-\/num-\/flights} respectively.

The parameters for the provided set of training instances can be found in the \href{https://github.com/TUPLES-Trustworthy-AI/Beluga-AI-Challenge-Benchmarks}{\texttt{ benchmarks repository}}.\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md42}{}\doxysubsection{\texorpdfstring{Fixed Configuration}{Fixed Configuration}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md42}
In addition to the instance generator can be configured with the following parameters. These also include distributions from which we draw a samples during instance generation. {\ttfamily \doxylink{default__configuration_8py}{configurations/default\+\_\+configuration.\+py}} contains the parameters and distributions we consider for the competition.\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md43}{}\doxysubsubsection{\texorpdfstring{Jigs}{Jigs}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md43}

\begin{DoxyItemize}
\item We use a fix set of 5 jig types ranging from 4 to 32 units of length.
\item {\ttfamily distribution\+\_\+initial\+\_\+jig\+\_\+state}\+: Used to determine whether a jig initially on the racks is loaded or empty. Here we select 50/50 between loaded or empty.
\end{DoxyItemize}\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md44}{}\doxysubsubsection{\texorpdfstring{Racks}{Racks}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md44}

\begin{DoxyItemize}
\item The rack size is sampled uniformly between 20 and 40
\item The number of racks depends on the number of flights and ranges between 1 and 20.
\end{DoxyItemize}\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md45}{}\doxysubsubsection{\texorpdfstring{Flights}{Flights}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md45}

\begin{DoxyItemize}
\item The storage capacity of the Beluga is fixed to 40.
\item {\ttfamily max\+\_\+delivery\+\_\+buffer}\+: maximal number of flights a jig waits before it is scheduled in a production line. For less than 50 flights it is {\ttfamily num\+\_\+flights \texorpdfstring{$\ast$}{*} 0.\+5} for more than 50 flights it is 25.
\item {\ttfamily distribution\+\_\+delivery\+\_\+buffer}\+: Used to sample how many flights a jig waits before it is scheduled in the production line. Must be less or equal to {\ttfamily max\+\_\+delivery\+\_\+buffer}. We use a truncated normal distribution with center {\ttfamily 0.\+25 \texorpdfstring{$\ast$}{*} max\+\_\+delivery\+\_\+buffer}, a standard deviation of {\ttfamily 0.\+5 \texorpdfstring{$\ast$}{*} max\+\_\+delivery\+\_\+buffer} a lower bound of {\ttfamily 1} and an upper bound of {\ttfamily max\+\_\+delivery\+\_\+buffer}.
\item {\ttfamily distribution\+\_\+next\+\_\+production\+\_\+line}\+: Used to determine which production line is scheduled next. The distribution depends on the number of jigs that have been delivered to a production line since the last delivery to any production line. We sample uniformly form a list of production lines, where the number of occurrences for each production line corresponds to how many jigs have been scheduled since this line has been chosen last.
\end{DoxyItemize}\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md46}{}\doxysubsubsection{\texorpdfstring{Trailers \& Hangars}{Trailers \& Hangars}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md46}
The number of trailers on the Beluga and on the factory side are sampled uniformly between 1 and 3. The same holds for the hangars.\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md47}{}\doxysubsubsection{\texorpdfstring{Production Lines}{Production Lines}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md47}
The number of trailers on the Beluga and on the factory side are sampled uniformly between 1 and 3. During the instance generation the parts are scheduled randomly between the production lines. To counteract an uneven distribution over the production lines, lines where fewer parts have been scheduled are preferred.\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md48}{}\doxysubsection{\texorpdfstring{Unsolvability Scenario}{Unsolvability Scenario}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md48}
In case an unsolvable instance is needed the following scenarios are supported\+:


\begin{DoxyItemize}
\item {\ttfamily RACK\+\_\+\+SPACE\+\_\+\+GENERAL}\+: Incoming flights carry the maximal number of jigs it is possible to fit in the Beluga, regardless of whether the racks have sufficient space to accommodate them. The outgoing flights are limited to at most one jig. This eventually results in more jigs on site than can fit on the racks and trailers. Depending on the number of flights, this strategy might not lead to an unsolvable instance.
\item {\ttfamily OUTGOING\+\_\+\+FLIGHT\+\_\+\+NOT\+\_\+\+SAT}\+: A random outgoing flight requires more jigs of a certain type than the number of jigs of that type that are on site, causing infeasibility.
\item {\ttfamily SCHEDULE\+\_\+\+CLASHES}\+: This scenario focuses on building instances with schedule clashes. A clash occurs for two loaded jigs J1 J2, if J2 arrives on a later flight than J1 but J2 needs to be delivered to a production line before J1. To build those instances, we modify the generator of the production schedule, by filling production schedules greedily to consume jigs in reverse order of their arrival. ~\newline
 This is a more advanced version of the {\ttfamily OUTGOING\+\_\+\+FLIGHT\+\_\+\+NOT\+\_\+\+SAT} scenario. However, it does not guarantee unsolvability.
\end{DoxyItemize}\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md49}{}\doxysection{\texorpdfstring{PDDL Encoding}{PDDL Encoding}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md49}
We provide a {\bfseries{classical}} as well as a {\bfseries{numeric}} PDDL encoding.

In the classical encoding the rack and jig sizes as well as the free space in each rack are encoded by individual {\ttfamily num\+XX} objects. The predicate {\ttfamily fit(a-\/b,b,a)} is then used to determine whether a jig still fits into a rack. For the numeric encoding however the rack and jig sizes are defined by functions and the {\itshape fit} check is done by a numeric comparison.

Except for these differences the classical and numeric encoding are the same.

To encode one instance you can use the script \begin{DoxyVerb}json2PDDL.py [-h] [-o PROBLEM_OUT] -i INSTANCE [-n]
\end{DoxyVerb}


It takes one JSON instance description and encodes it per default as a classic PDDL problem or with {\ttfamily -\/n} using the numeric encoding. A matching domain file is automatically generated.

To encode multiple instances use \begin{DoxyVerb}encode_instances.py [-h] [-n] -i I -o O [-y]
\end{DoxyVerb}


It encodes all instances and generates matching domain files.\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md50}{}\doxysection{\texorpdfstring{Scikit-\/decide Domain Tester}{Scikit-\/decide Domain Tester}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md50}
The toolkit includes a script for testing the three scikit-\/decide domains developed for the competition; these can be used by the competitors to assist the development of their own solution, they are employed by the (trivial) example planners included in the toolkit, and are used as the basis for the evaluation scripts.

The three domains are built around the {\ttfamily plado} module and are respectively\+:


\begin{DoxyItemize}
\item {\ttfamily Skd\+PDDLDomain}\+: a deterministic problem domain that can rely on either the classic or the numeric PDDL encodings used in the competition
\item {\ttfamily Skd\+SPDDLDomain}\+: a probabilistic domain suitable for use in Reinforcement Learning solutions
\item {\ttfamily Skd\+PPDDLDomain}\+: a probabilistic domain compatible with the abstract probabilistic model and with the coresponding PPDDL encoding
\end{DoxyItemize}

The testing script generates a problem instance and then triggers a simulation process, where a valid action are sampled at random at every step.

The usage is as follows\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{usage:\ generate\_simulate\_test.py\ [-\/h]\ [-\/s\ SEED]\ [-\/njt\ NUM\_JIG\_TYPES]\ [-\/or\ OCCUPANCY\_RATE\_RACKS]\ [-\/r\ NUM\_RACKS]\ [-\/msr\ MAX\_SIZE\_RACKS]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [-\/f\ NUM\_FLIGHTS]\ [-\/sb\ SIZE\_BELUGA]\ [-\/bt\ NUM\_BELUGA\_TRAILERS]\ [-\/ft\ NUM\_FACTORY\_TRAILERS]\ [-\/hs\ NUM\_HANGARS]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [-\/p\ NUM\_PRODUCTION\_LINES]\ [-\/us\ \{rack\_space\_general,outgoing\_flight\_not\_sat,schedule\_clashes\}]\ [-\/v]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [-\/o\ OUT]\ [-\/on\ OUT\_NAME]\ [-\/pp]\ [-\/pm\ \{arrivals,ppddl\}]\ [-\/pw\ PROBABILISTIC\_WINDOW]\ [-\/n]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [-\/ms\ MAX\_SIMULATION\_STEPS]}

\end{DoxyCode}


The configuration parameters include those used by the problem generator, plus\+:


\begin{DoxyItemize}
\item {\ttfamily -\/n} numeric encoding, otherwise classic encoding (default\+: False)
\item {\ttfamily -\/ms MAX\+\_\+\+SIMULATION\+\_\+\+STEPS} maximum number of simulation steps unless the goal is reached before (default\+: None)
\end{DoxyItemize}\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md51}{}\doxysection{\texorpdfstring{Gymnasium Environment Tester}{Gymnasium Environment Tester}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md51}
The toolkit provides a way to cast each of the 3 above scikit-\/decide Beluga domains to a gymnasium environment to be used by deep reinforcement learning approaches. This can be done in 2 steps\+:


\begin{DoxyEnumerate}
\item Specialize the {\ttfamily Beluga\+Gym\+Compatible\+Domain} class defined in the {\ttfamily \doxylink{skd__gym__domain_8py}{skd\+\_\+gym\+\_\+domain.\+py}} script to your tensor representation needs ;
\item Pass your specialized domain class to the {\ttfamily Beluga\+Gym\+Env} class defined in the same script; this will be your gym environment.
\end{DoxyEnumerate}

The {\ttfamily \doxylink{generate__solve__rllib__test_8py}{generate\+\_\+solve\+\_\+rllib\+\_\+test.\+py}} script gives an example of such a specialized gym-\/compatible domain class that can make each of the original domain classes (i.\+e. {\ttfamily Skd\+PDDLDomain}, {\ttfamily Skd\+SPDDLDomain} or {\ttfamily Skd\+PPDDLDomain}) use state and action tensors. The script further shows how to pass an instance of this gym-\/compatible domain class to the {\ttfamily Beluga\+Gym\+Env} class, and how to call RLlib\textquotesingle{}s PPO algorithm on this gym environment class. The script can be used as follows\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{usage:\ generate\_solve\_rllib\_test.py\ [-\/h]\ [-\/s\ SEED]\ [-\/njt\ NUM\_JIG\_TYPES]\ [-\/or\ OCCUPANCY\_RATE\_RACKS]\ [-\/r\ NUM\_RACKS]\ [-\/msr\ MAX\_SIZE\_RACKS]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [-\/f\ NUM\_FLIGHTS]\ [-\/sb\ SIZE\_BELUGA]\ [-\/bt\ NUM\_BELUGA\_TRAILERS]\ [-\/ft\ NUM\_FACTORY\_TRAILERS]\ [-\/hs\ NUM\_HANGARS]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [-\/p\ NUM\_PRODUCTION\_LINES]\ [-\/us\ \{rack\_space\_general,outgoing\_flight\_not\_sat,schedule\_clashes\}]\ [-\/v]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [-\/o\ OUT]\ [-\/on\ OUT\_NAME]\ [-\/pp]\ [-\/pm\ \{arrivals,ppddl\}]\ [-\/pw\ PROBABILISTIC\_WINDOW]\ [-\/n]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [-\/ms\ MAX\_SIMULATION\_STEPS]}

\end{DoxyCode}


The configuration parameters are the same as the ones of the scikit-\/decide domain tester.\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md52}{}\doxysection{\texorpdfstring{Evaluator}{Evaluator}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md52}
The toolkit includes a template for an evaluation script relying on the same protocol employed for the official competition. This can be useful both for testing the API of the solutions developed by the competitor, and for computing the official KPIs.

In particular, this evaluation script is designed to test solutions complying with the API in {\ttfamily \doxylink{planner__api_8py}{evaluation/planner\+\_\+api.\+py}}, and provides support for naive example implementations (based on random action sampling and the Lazy A\texorpdfstring{$\ast$}{*} solver from scikit-\/decide). The code for these examples can be found in {\ttfamily \doxylink{planner__examples_8py}{evaluation/planner\+\_\+examples.\+py}} and can be used as a starting point for the competitors\textquotesingle{} code.

The script can be used or modified to handle new solution approaches as follows\+:


\begin{DoxyItemize}
\item Competitors can modify the {\ttfamily build\+\_\+planner} function in {\ttfamily \doxylink{evaluate__instance_8py}{evaluate\+\_\+instance.\+py}} to add support for their own approach
\item For the deterministic track, it is also possible to use the script to evaluate a pre-\/built plan, in JSON format, by using the {\ttfamily -\/-\/prebuilt-\/plan} command line option; this approach is not available for the probabilistic track, for which the goal is building a policy rather than a single plan
\end{DoxyItemize}

We stress that this script should be considered just a template. The official evaluation will rely on an implementation based on web services. A default wrapper will be made available for solution approaches based on the API from {\ttfamily \doxylink{planner__api_8py}{evaluation/planner\+\_\+api.\+py}}.

The evaluation script can be used as follows\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{usage:\ evaluate\_instance.py\ [-\/h]\ [-\/i\ INPUT\_PROBLEM]\ [-\/s\ SEED]\ [-\/or\ OCCUPANCY\_RATE\_RACKS]\ [-\/t\ JIG\_T\_DIST]\ [-\/f\ NUM\_FLIGHTS]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [-\/us\ \{rack\_space\_general,outgoing\_flight\_not\_sat,schedule\_clashes\}]\ [-\/v]\ [-\/o\ OUT]\ [-\/on\ OUT\_NAME]\ [-\/pp]\ [-\/pm\ \{arrivals,ppddl\}]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [-\/ms\ MAX\_SIMULATION\_STEPS]\ [-\/ns\ NUM\_SAMPLES]\ [-\/tl\ TIME\_LIMIT]\ [-\/pln\ \{random,lazy\_astar\}]\ [-\/-\/prebuilt-\/plan\ DET\_PLAN\_FILE]\ [-\/ppe]}

\end{DoxyCode}


The script can be used to evaluate a solution on an existing instance (by specifying the {\ttfamily -\/-\/input} parameter) or on an instance generated on the fly. The parameters include those used by the generator (which are ignored in case {\ttfamily -\/-\/input} is used), plus\+:


\begin{DoxyItemize}
\item {\ttfamily -\/ms MAX\+\_\+\+SIMULATION\+\_\+\+STEPS}, {\ttfamily -\/-\/max\+\_\+steps MAX\+\_\+\+SIMULATION\+\_\+\+STEPS} maximum number of steps within which the goal should be reached (default\+: 50)
\item {\ttfamily -\/ns NUM\+\_\+\+SAMPLES}, {\ttfamily -\/-\/num\+\_\+samples NUM\+\_\+\+SAMPLES} number of samples for the evaluation. This parameter has no effect in case of a deterministic evaluation (default\+: 1) -\/tl TIME\+\_\+\+LIMIT, --time-\/limit TIME\+\_\+\+LIMIT time limit for the evaluation (default\+: None)
\item {\ttfamily -\/pln \{random,lazy\+\_\+astar\}}, {\ttfamily -\/-\/planner \{random,lazy\+\_\+astar\}} the planner to be used for the test (default\+: random)
\item {\ttfamily -\/ppe}, {\ttfamily -\/-\/probabilistic-\/evaluation} enable probabilistic evaluation; this is automtically enable in case a probabilistic instance is generated (default\+: False)
\item {\ttfamily -\/-\/prebuilt-\/plan DET\+\_\+\+PLAN\+\_\+\+FILE} When this opton is used, the evaluator will process a single, pre-\/built plan in JSON format. Using this option\+: 1) overrides plan construction; 2) requires to specify and input plan; and 3) is incompatible with probabilistic evaluation (default\+: None)
\end{DoxyItemize}\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md53}{}\doxysection{\texorpdfstring{Probabilistic Model}{Probabilistic Model}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md53}
The probabilistic problem variants account for the fact that in the real world flights can deviate from their scheduled arrival times. This process is simulated according to a simplified uncertainty model, which works as follows\+:


\begin{DoxyItemize}
\item When a problem instance is generated, we assign to each flight a scheduled arrival time
\item When a plan is executed, we simulate the delays
\end{DoxyItemize}

For this reason, all tools designed to work with the probabilistic problem require instances generated with the {\ttfamily -\/pp} flag. In addition, the PPDDL encoder and the related scikit-\/decide domain require access to the parameters of the abstracted uncertainty model, which are also built at instance generation time, by passing the command line argument {\ttfamily -\/pm ppddl}.

Scheduled arrival times are generated as follows\+:


\begin{DoxyItemize}
\item For each hour in a day\+:
\begin{DoxyItemize}
\item We sample a number of arrivals according to a Poisson distribution
\item We assign arrival times within the considered hour according to a uniform distribution
\end{DoxyItemize}
\end{DoxyItemize}

The rates for the Poisson distribution depend on the hour of the day and have been calibrated based on real world arrival data. Such rates are available in the file {\ttfamily \doxylink{hourly__rates_8json}{utils/configuration/hourly\+\_\+rates.\+json}}. The same distribution is employed to generate all benchmark instances in the competition, including the training instances (provided to all competitors), the validation instances (used to compute metrics when a new submission is made), and the test instances (employed to obtain the final competition ranking).

Delays are generated following a discretized continuous distribution, also calibrated on real-\/world data. Information on the distribution can be found in the file {\ttfamily \doxylink{delay__distribution_8json}{utils/configuration/delay\+\_\+distribution.\+json}}. The same distribution is used to simulate all benchmark instances in the competition.\hypertarget{md_toolkit_2_r_e_a_d_m_e_autotoc_md54}{}\doxysection{\texorpdfstring{Benchmark Distributions}{Benchmark Distributions}}\label{md_toolkit_2_r_e_a_d_m_e_autotoc_md54}
All benchmark instances for the scalability challenges are sampled from the same distribution for the problem generator. This also applies to the probabilistic benchmarks, since the same parameters for the uncertainty model are used in all cases.

In detail, we consider the three main problem generator parameters, i.\+e.\+:


\begin{DoxyItemize}
\item The initial occupancy rate of the rackes (i.\+e. the {\ttfamily -\/oc} parameter in the generator)
\item The jig type distribution (i.\+e. the {\ttfamily -\/t} parameter in the generator)
\item The number of flights (i.\+e. the {\ttfamily -\/f} parameter in the generator)
\end{DoxyItemize}

In effort to improve coverage of the possible parameter combinations, their values are obtained via Latin Hypercube Sampling, considering the following ranges\+:


\begin{DoxyItemize}
\item Three possible occupancy values, i.\+e. 20, 50, and 80
\item The three possible jig type distributions, i.\+e. 0, 1, and 2
\item Values in \mbox{[}0, sqrt(200-\/3)\mbox{]} for the square root of the number of flights in addition to a minimum (which consists of 3 flights)
\end{DoxyItemize}

The process results in an approximately uniform distribution for the occupancy levels and the jig type distribution. The sampled number of flights are in the range \mbox{[}3..200\mbox{]}, with a bias in favor of smaller instance, due to the use of a non-\/linear scale. 